# Домашнее задание к занятию 11 «Teamcity»

**Ссылка на репозиторий:** https://github.com/VTB55/example-teamcity

## Итог выполнения задания

### 1. Подготовка к выполнению
- В Yandex Cloud создан новый инстанс (4CPU4RAM) на основе образа `jetbrains/teamcity-server`
- Выполнен запуск TeamCity и произведена первоначальная настройка
- Создан инстанс TeamCity Agent (2CPU4RAM) на основе образа `jetbrains/teamcity-agent` с настроенной переменной окружения `SERVER_URL`
- TeamCity Agent авторизован на сервере
- Выполнен fork исходного репозитория для работы над заданием
- Создана отдельная VM (2CPU4RAM) и запущен Ansible playbook для подготовки окружения

### 2. Создание и настройка проекта в TeamCity
- Создан новый проект в TeamCity на основе fork репозитория
- Выполнен autodetect конфигурации проекта (определен как Maven)
- Сохранены необходимые шаги конфигурации
- Запущена и успешно выполнена первая сборка по ветке master

### 3. Настройка условных сборок
- Реализованы разные сценарии сборки в зависимости от ветки:
  - Для ветки `master`: выполняется `mvn clean deploy`
  - Для остальных веток: выполняется `mvn clean test`

### 4. Интеграция с Nexus
- Для деплоя загружен `settings.xml` в набор конфигураций Maven в TeamCity с предварительно записанными учетными данными для подключения к Nexus
- В `pom.xml` обновлены ссылки на репозиторий и Nexus
- Запущена сборка по master, успешно выполнен деплой артефакта в Nexus
- Подтверждено появление артефакта в репозитории Nexus

### 5. Работа с Versioned Settings
- Build configuration мигрирована в репозиторий через настройку Versioned Settings
- Конфигурация TeamCity хранится в директории `.teamcity/` в репозитории

### 6. Разработка нового функционала
- Создана отдельная ветка `feature/add_reply` в репозитории
- Написан новый метод для класса `Welcomer`, возвращающий произвольную реплику, содержащую слово "hunter"
- Дополнен тест для нового метода на поиск слова "hunter" в возвращаемой реплике
- Выполнен push всех изменений в новую ветку репозитория

### 7. Автоматизация сборок
- Убежден, что сборка самостоятельно запустилась при push в ветку `feature/add_reply`
- Все тесты прошли успешно в автоматическом режиме

### 8. Слияние изменений и финальная сборка
- Изменения из ветки `feature/add_reply` внесены в `master` через Merge
- Убежден, что нет собранного артефакта в сборке по ветке master после merge (выполнялись только тесты)
- Настроена конфигурация для сборки `.jar` в артефакты сборки
- Проведена повторная сборка мастера с подтверждением успешного выполнения и сборки артефактов
- Проверено, что конфигурация в репозитории содержит все настройки конфигурации из TeamCity

## Результат

В результате выполнения задания успешно настроен и протестирован полный CI/CD pipeline на основе TeamCity. 
Реализована автоматическая сборка и тестирование кода при изменениях в репозитории Git, с условной логикой для разных веток. Для основной ветки master настроен автоматический деплой собранных артефактов в Nexus Repository. Вся конфигурация TeamCity хранится в репозитории через Versioned Settings, что соответствует принципам Infrastructure as Code. Разработан и протестирован новый функционал в рамках feature-ветки с последующим слиянием в основную ветку. Все требования домашнего задания выполнены в полном объеме.
